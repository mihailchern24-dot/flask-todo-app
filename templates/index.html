{% extends "base.html" %}

{% block title %}–ó–∞–¥–∞—á–∏ - –£–º–Ω–∞—è —Ä–∞–∑–≥—Ä—É–∑–∫–∞{% endblock %}

{% block extra_js %}
<script>
// ==================== –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ====================
const CONFIG = {
    itemsPerPage: 20,
    checkRemindersInterval: 60000,  // –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    refreshTasksInterval: 30000,     // –û–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–¥–∞—á–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    enableAutoRefresh: true
};

// ==================== –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ====================
let appState = {
    currentPage: 1,
    totalPages: 1,
    totalTasks: 0,
    isLoading: false,
    lastUpdate: null,
    autoRefreshInterval: null
};

// ==================== DOM —ç–ª–µ–º–µ–Ω—Ç—ã ====================
const elements = {
    tasks: document.getElementById('tasks'),
    loadMore: document.getElementById('load-more'),
    addBtn: document.getElementById('add'),
    titleInput: document.getElementById('title'),
    dueInput: document.getElementById('due'),
    notificationContainer: document.getElementById('notification-container'),
    tasksCount: document.getElementById('tasks-count'),
    lastUpdate: document.getElementById('last-update'),
    autoRefreshToggle: document.getElementById('auto-refresh-toggle')
};

// ==================== –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å DOM ====================
function escapeHTML(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatDateTime(isoString) {
    if (!isoString) return '–ë–µ–∑ —Å—Ä–æ–∫–∞';
    
    try {
        const date = new Date(isoString);
        const now = new Date();
        const diffHours = Math.floor((date - now) / (1000 * 60 * 60));
        
        if (diffHours < 0) {
            return `<span class="task-overdue">${date.toLocaleString()} (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ)</span>`;
        } else if (diffHours < 24) {
            return `<span style="color: #e74c3c;">${date.toLocaleString()} (—Å–∫–æ—Ä–æ)</span>`;
        } else if (diffHours < 168) {
            return `<span style="color: #f39c12;">${date.toLocaleString()}</span>`;
        } else {
            return date.toLocaleString();
        }
    } catch {
        return isoString;
    }
}

function createTaskElement(task) {
    const isDone = task.done === 'True' || task.done === 'true' || task.done === '1' || task.done === true;
    const isOverdue = task.is_overdue || (new Date(task.due_iso) < new Date() && !isDone && task.due_iso);
    
    const taskElement = document.createElement('li');
    taskElement.className = `task ${isDone ? 'done' : ''} ${isOverdue ? 'overdue' : ''}`;
    taskElement.dataset.id = task.id;
    taskElement.dataset.uuid = task.uuid;
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'task-content';
    
    const titleDiv = document.createElement('div');
    titleDiv.className = 'task-title';
    titleDiv.textContent = task.title || '(–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)';
    contentDiv.appendChild(titleDiv);
    
    const metaDiv = document.createElement('div');
    metaDiv.className = 'task-meta';
    
    if (task.uuid) {
        const uuidSpan = document.createElement('span');
        uuidSpan.className = 'task-uuid';
        uuidSpan.textContent = task.uuid.substring(0, 8) + '...';
        uuidSpan.title = task.uuid;
        metaDiv.appendChild(uuidSpan);
    }
    
    if (task.due_iso) {
        const dueSpan = document.createElement('span');
        dueSpan.className = 'task-due';
        dueSpan.innerHTML = formatDateTime(task.due_iso);
        metaDiv.appendChild(dueSpan);
    }
    
    if (task.description) {
        const descSpan = document.createElement('span');
        descSpan.className = 'task-description';
        descSpan.textContent = task.description;
        descSpan.title = task.description;
        metaDiv.appendChild(descSpan);
    }
    
    const createdSpan = document.createElement('span');
    createdSpan.className = 'task-created';
    if (task.created_at) {
        createdSpan.textContent = `–°–æ–∑–¥–∞–Ω–æ: ${new Date(task.created_at).toLocaleDateString()}`;
    }
    metaDiv.appendChild(createdSpan);
    
    contentDiv.appendChild(metaDiv);
    taskElement.appendChild(contentDiv);
    
    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'task-actions';
    
    const toggleBtn = document.createElement('button');
    toggleBtn.className = 'task-btn toggle-btn';
    toggleBtn.innerHTML = `<i class="fas fa-${isDone ? 'undo' : 'check'}"></i> ${isDone ? '–í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å' : '–í—ã–ø–æ–ª–Ω–∏—Ç—å'}`;
    toggleBtn.onclick = () => toggleTaskDone(task.id, !isDone);
    actionsDiv.appendChild(toggleBtn);
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'task-btn delete-btn';
    deleteBtn.innerHTML = `<i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å`;
    deleteBtn.onclick = () => deleteTask(task.id);
    actionsDiv.appendChild(deleteBtn);
    
    taskElement.appendChild(actionsDiv);
    
    return taskElement;
}

function updateTaskElement(taskElement, task) {
    const isDone = task.done === 'True' || task.done === 'true' || task.done === '1' || task.done === true;
    
    taskElement.classList.toggle('done', isDone);
    
    const titleDiv = taskElement.querySelector('.task-title');
    if (titleDiv) {
        titleDiv.textContent = task.title || '(–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)';
    }
    
    const dueSpan = taskElement.querySelector('.task-due');
    if (dueSpan && task.due_iso) {
        dueSpan.innerHTML = formatDateTime(task.due_iso);
    }
    
    const toggleBtn = taskElement.querySelector('.toggle-btn');
    if (toggleBtn) {
        toggleBtn.innerHTML = `<i class="fas fa-${isDone ? 'undo' : 'check'}"></i> ${isDone ? '–í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å' : '–í—ã–ø–æ–ª–Ω–∏—Ç—å'}`;
        toggleBtn.onclick = () => toggleTaskDone(task.id, !isDone);
    }
}

// ==================== –†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏ ====================
async function loadTasks(reset = true) {
    if (appState.isLoading) return;
    
    appState.isLoading = true;
    showLoading(reset);
    
    try {
        const page = reset ? 1 : appState.currentPage;
        const response = await fetch(`/api/tasks?page=${page}&per_page=${CONFIG.itemsPerPage}`);
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json();
        
        appState.totalPages = data.meta.pages || 1;
        appState.totalTasks = data.meta.total || 0;
        appState.lastUpdate = new Date();
        
        if (reset) {
            appState.currentPage = 1;
            elements.tasks.innerHTML = '';
        }
        
        if (data.items.length === 0 && reset) {
            showEmptyState();
        } else {
            data.items.forEach(task => {
                const existingTask = elements.tasks.querySelector(`[data-id="${task.id}"]`);
                if (existingTask) {
                    updateTaskElement(existingTask, task);
                } else {
                    const taskElement = createTaskElement(task);
                    elements.tasks.appendChild(taskElement);
                }
            });
        }
        
        updateLoadMoreButton();
        updateStatsDisplay();
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º.');
    } finally {
        appState.isLoading = false;
        hideLoading();
    }
}

async function addTask() {
    const title = elements.titleInput.value.trim();
    const due = elements.dueInput.value;
    
    if (!title) {
        showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏', 'error');
        elements.titleInput.focus();
        return;
    }
    
    const dueIso = due ? new Date(due).toISOString() : '';
    
    try {
        const response = await fetch('/api/tasks', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title,
                due_iso: dueIso
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || `–û—à–∏–±–∫–∞ ${response.status}`);
        }
        
        elements.titleInput.value = '';
        elements.dueInput.value = '';
        elements.titleInput.focus();
        
        showNotification('–£—Å–ø–µ—à–Ω–æ', '–ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
        await loadTasks(true);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
        showNotification('–û—à–∏–±–∫–∞', `–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É: ${error.message}`, 'error');
    }
}

async function toggleTaskDone(taskId, done) {
    try {
        const response = await fetch(`/api/tasks/${taskId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ done })
        });
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
        }
        
        const task = await response.json();
        
        showNotification('–£—Å–ø–µ—à–Ω–æ', `–ó–∞–¥–∞—á–∞ ${done ? '–≤—ã–ø–æ–ª–Ω–µ–Ω–∞' : '–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞'}`, 'success');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
        const taskElement = elements.tasks.querySelector(`[data-id="${taskId}"]`);
        if (taskElement) {
            updateTaskElement(taskElement, task);
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
        showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É', 'error');
    }
}

async function deleteTask(taskId) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/tasks/${taskId}`, {
            method: 'DELETE'
        });
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
        }
        
        removeTaskFromList(taskId);
        showNotification('–£—Å–ø–µ—à–Ω–æ', '–ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
        showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É', 'error');
    }
}

function removeTaskFromList(taskId) {
    const taskElement = elements.tasks.querySelector(`[data-id="${taskId}"]`);
    if (taskElement) {
        taskElement.remove();
    }
    
    // –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (elements.tasks.children.length === 0) {
        showEmptyState();
    }
}

// ==================== –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è ====================
async function checkReminders() {
    try {
        const response = await fetch('/api/check_reminders');
        if (!response.ok) return;
        
        const data = await response.json();
        
        if (data.reminders && data.reminders.length > 0) {
            data.reminders.forEach(reminder => {
                showNotification(
                    '‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ',
                    `${reminder.title}\n${reminder.due_iso ? new Date(reminder.due_iso).toLocaleString() : ''}`,
                    'reminder'
                );
                
                // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                playNotificationSound();
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:', error);
    }
}

// ==================== –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ====================
function showLoading(reset) {
    if (reset) {
        elements.tasks.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>';
    }
}

function hideLoading() {
    const loadingElement = elements.tasks.querySelector('.loading');
    if (loadingElement) {
        loadingElement.remove();
    }
}

function showEmptyState() {
    elements.tasks.innerHTML = `
        <div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <h3>–ù–µ—Ç –∑–∞–¥–∞—á</h3>
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É!</p>
        </div>
    `;
}

function showError(message) {
    elements.tasks.innerHTML = `
        <div class="empty-state">
            <div class="empty-state-icon">‚ùå</div>
            <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <p>${escapeHTML(message)}</p>
            <button onclick="loadTasks(true)" class="task-btn toggle-btn" style="margin-top: 15px;">
                <i class="fas fa-redo"></i> –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
            </button>
        </div>
    `;
}

function updateLoadMoreButton() {
    if (appState.currentPage < appState.totalPages) {
        elements.loadMore.style.display = 'block';
    } else {
        elements.loadMore.style.display = 'none';
    }
}

function updateStatsDisplay() {
    if (elements.tasksCount) {
        elements.tasksCount.textContent = `–í—Å–µ–≥–æ –∑–∞–¥–∞—á: ${appState.totalTasks}`;
    }
    if (elements.lastUpdate && appState.lastUpdate) {
        elements.lastUpdate.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${appState.lastUpdate.toLocaleTimeString()}`;
    }
}

function showNotification(title, message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <h4>${escapeHTML(title)}</h4>
        <p>${escapeHTML(message)}</p>
        <button class="close-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    elements.notificationContainer.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 8000);
}

function playNotificationSound() {
    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–≤—É–∫ —á–µ—Ä–µ–∑ Web Audio API
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
    } catch (error) {
        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
    }
}

// ==================== –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º ====================
function toggleAutoRefresh() {
    if (appState.autoRefreshInterval) {
        clearInterval(appState.autoRefreshInterval);
        appState.autoRefreshInterval = null;
        showNotification('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ', '–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ', 'info');
    } else {
        startAutoRefresh();
        showNotification('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ', '–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ', 'success');
    }
    
    if (elements.autoRefreshToggle) {
        elements.autoRefreshToggle.innerHTML = appState.autoRefreshInterval ? 
            '<i class="fas fa-toggle-on"></i> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –í–ö–õ' :
            '<i class="fas fa-toggle-off"></i> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –í–´–ö–õ';
    }
}

function startAutoRefresh() {
    if (appState.autoRefreshInterval) {
        clearInterval(appState.autoRefreshInterval);
    }
    
    appState.autoRefreshInterval = setInterval(() => {
        if (!appState.isLoading && document.visibilityState === 'visible') {
            loadTasks(true);
        }
    }, CONFIG.refreshTasksInterval);
}

// ==================== –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ====================
elements.addBtn.addEventListener('click', addTask);

elements.titleInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        addTask();
    }
});

elements.loadMore.addEventListener('click', () => {
    if (appState.currentPage < appState.totalPages) {
        appState.currentPage++;
        loadTasks(false);
    }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –¥–ª—è input datetime-local
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    
    elements.dueInput.min = `${year}-${month}-${day}T${hours}:${minutes}`;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏
    loadTasks(true);
    
    // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    elements.titleInput.focus();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
    setInterval(checkReminders, CONFIG.checkRemindersInterval);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
    if (CONFIG.enableAutoRefresh) {
        startAutoRefresh();
    }
});

// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
        loadTasks(true);
    }
});

// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –æ–∫–Ω–µ
window.addEventListener('focus', () => {
    loadTasks(true);
});
</script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="top-bar">
        <div class="user-info">
            <i class="fas fa-user"></i> {{ username }}
        </div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">
                <i class="fas fa-tasks"></i> –ó–∞–¥–∞—á–∏
            </a>
            <a href="{{ url_for('about') }}">
                <i class="fas fa-info-circle"></i> –û –ø—Ä–æ–µ–∫—Ç–µ
            </a>
            <a href="{{ url_for('logout') }}">
                <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
            </a>
        </div>
    </div>
    
    <div class="content">
        <h1><i class="fas fa-clipboard-list"></i> –£–º–Ω–∞—è —Ä–∞–∑–≥—Ä—É–∑–∫–∞</h1>
        
        <div class="controls">
            <input 
                id="title" 
                type="text" 
                placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?" 
                autocomplete="off"
                aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
            >
            <input 
                id="due" 
                type="datetime-local" 
                aria-label="–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"
                title="–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏"
            >
            <button id="add" aria-label="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
            </button>
            <button id="load-more" aria-label="–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ">
                <i class="fas fa-arrow-down"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë
            </button>
        </div>
        
        <div class="status-bar">
            <div id="tasks-count">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="last-update">–û–±–Ω–æ–≤–ª–µ–Ω–æ: --:--:--</div>
        </div>
        
        <ul id="tasks" aria-label="–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á">
            <!-- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
        </ul>
        
        <div class="stats">
            <p><small><i class="fas fa-info-circle"></i> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥</small></p>
            <button id="auto-refresh-toggle" class="task-btn toggle-btn" onclick="toggleAutoRefresh()" style="margin-top: 10px;">
                <i class="fas fa-toggle-on"></i> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –í–ö–õ
            </button>
        </div>
    </div>
</div>
{% endblock %}